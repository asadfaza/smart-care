{% extends "base.html" %}

{% block title %}Admin Panel - Smart Care{% endblock %}

{% block content %}
<div class="admin-panel">
    <div class="container">
        <header class="admin-header">
            <h1><i class="fas fa-cog"></i> Admin Panel - Smart Care</h1>
            <p class="subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –∏ –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏</p>
        </header>

        <div class="admin-navigation">
            <button class="admin-tab active" data-tab="translations">
                <i class="fas fa-language"></i> –ü–µ—Ä–µ–≤–æ–¥—ã
            </button>
            <button class="admin-tab" data-tab="team">
                <i class="fas fa-users"></i> –ö–æ–º–∞–Ω–¥–∞
            </button>
            <button class="admin-tab" data-tab="roadmap">
                <i class="fas fa-road"></i> –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞
            </button>
            <button class="admin-tab" data-tab="settings">
                <i class="fas fa-wrench"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
        </header>

        <!-- Translations Tab -->
        <div class="admin-content active" id="translations-tab">
            <div class="section-header">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏</h2>
                <button class="btn-primary" onclick="saveTranslations()">
                    <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ
                </button>
            </div>

            <div class="language-selector">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫:</label>
                <select id="lang-select" onchange="loadTranslations()">
                    <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                    <option value="en">üá¨üáß English</option>
                </select>
            </div>

            <div class="translations-list" id="translations-content">
                <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>

        <!-- Team Tab -->
        <div class="admin-content" id="team-tab">
            <div class="section-header">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π</h2>
                <button class="btn-primary" onclick="addTeamMember()">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —á–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥—ã
                </button>
            </div>
            <div id="team-content" class="team-list">
                <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>

        <!-- Roadmap Tab -->
        <div class="admin-content" id="roadmap-tab">
            <div class="section-header">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç–æ–π</h2>
                <button class="btn-primary" onclick="addMilestone()">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å milestone
                </button>
            </div>
            <div id="roadmap-content" class="roadmap-list">
                <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="admin-content" id="settings-tab">
            <div class="section-header">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            </div>
            <div class="settings-grid">
                <div class="setting-item">
                    <h3><i class="fas fa-database"></i> Firebase Status</h3>
                    <p id="firebase-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</p>
                    <button class="btn-secondary" onclick="checkFirebaseStatus()">
                        <i class="fas fa-sync"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                    </button>
                </div>
                <div class="setting-item">
                    <h3><i class="fas fa-trash"></i> –ö—ç—à</h3>
                    <p>–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
                    <button class="btn-danger" onclick="clearCache()">
                        <i class="fas fa-trash-alt"></i> –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
                    </button>
                </div>
                <div class="setting-item">
                    <h3><i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                    <p>–°–∫–∞—á–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ JSON</p>
                    <button class="btn-secondary" onclick="exportData()">
                        <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.admin-panel {
    padding: 40px 20px;
    min-height: 100vh;
    background: var(--light-gray);
}

.admin-header {
    text-align: center;
    margin-bottom: 40px;
    padding: 30px;
    background: var(--white);
    border-radius: 15px;
    box-shadow: 0 5px 15px var(--shadow);
}

.admin-header h1 {
    color: var(--primary-blue);
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.admin-header .subtitle {
    color: var(--text-light);
    font-size: 1.1rem;
}

.admin-navigation {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
    flex-wrap: wrap;
}

.admin-tab {
    flex: 1;
    min-width: 150px;
    padding: 15px 25px;
    background: var(--white);
    border: 2px solid var(--light-gray);
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text);
    transition: all 0.3s;
    cursor: pointer;
}

.admin-tab:hover {
    border-color: var(--primary-blue);
    color: var(--primary-blue);
    transform: translateY(-2px);
}

.admin-tab.active {
    background: var(--primary-blue);
    color: var(--white);
    border-color: var(--primary-blue);
}

.admin-content {
    display: none;
    background: var(--white);
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 5px 15px var(--shadow);
}

.admin-content.active {
    display: block;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--light-gray);
}

.section-header h2 {
    margin: 0;
    color: var(--primary-blue);
}

.btn-primary, .btn-secondary, .btn-danger {
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    border: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background: var(--primary-blue);
    color: var(--white);
}

.btn-primary:hover {
    background: var(--dark-blue);
    transform: translateY(-2px);
}

.btn-secondary {
    background: var(--light-gray);
    color: var(--text);
}

.btn-secondary:hover {
    background: var(--text-light);
    color: var(--white);
}

.btn-danger {
    background: #ff6b6b;
    color: var(--white);
}

.btn-danger:hover {
    background: #ee5a52;
}

.language-selector {
    margin-bottom: 30px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.language-selector label {
    font-weight: 600;
    color: var(--text);
}

.language-selector select {
    padding: 10px 15px;
    border: 2px solid var(--light-gray);
    border-radius: 8px;
    font-size: 1rem;
    background: var(--white);
    cursor: pointer;
}

.translations-list, .team-list, .roadmap-list {
    display: grid;
    gap: 20px;
}

.translation-item, .team-item, .roadmap-item {
    padding: 20px;
    background: var(--light-gray);
    border-radius: 10px;
    border: 2px solid transparent;
    transition: all 0.3s;
}

.translation-item:hover, .team-item:hover, .roadmap-item:hover {
    border-color: var(--primary-blue);
}

.translation-item label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text);
}

.translation-item input, .translation-item textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--light-gray);
    border-radius: 5px;
    font-size: 1rem;
    font-family: 'Poppins', sans-serif;
}

.translation-item textarea {
    min-height: 80px;
    resize: vertical;
}

.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.setting-item {
    padding: 25px;
    background: var(--light-gray);
    border-radius: 10px;
    text-align: center;
}

.setting-item h3 {
    color: var(--primary-blue);
    margin-bottom: 10px;
}

.setting-item p {
    color: var(--text-light);
    margin-bottom: 15px;
}

#firebase-status {
    font-weight: 600;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 15px;
}

#firebase-status.success {
    background: #51cf66;
    color: var(--white);
}

#firebase-status.error {
    background: #ff6b6b;
    color: var(--white);
}

@media (max-width: 768px) {
    .admin-header h1 {
        font-size: 1.8rem;
    }
    
    .section-header {
        flex-direction: column;
        gap: 15px;
        align-items: stretch;
    }
    
    .admin-tab {
        min-width: 100%;
    }
}
</style>

<script>
// –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫
let currentLang = 'ru';

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
document.querySelectorAll('.admin-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        // –£–±–∏—Ä–∞–µ–º active —É –≤—Å–µ—Ö —Ç–∞–±–æ–≤
        document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.admin-content').forEach(c => c.classList.remove('active'));
        
        // –î–æ–±–∞–≤–ª—è–µ–º active –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É
        this.classList.add('active');
        const tabId = this.getAttribute('data-tab');
        document.getElementById(tabId + '-tab').classList.add('active');
    });
});

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
async function loadTranslations() {
    currentLang = document.getElementById('lang-select').value;
    const container = document.getElementById('translations-content');
    container.innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
    
    try {
        const response = await fetch(`/api/translations/${currentLang}`);
        const data = await response.json();
        
        let html = '';
        for (const [section, content] of Object.entries(data)) {
            html += `<div class="translation-section">
                <h3><i class="fas fa-folder"></i> ${section}</h3>`;
            
            for (const [key, value] of Object.entries(content)) {
                if (typeof value === 'string') {
                    html += `
                        <div class="translation-item">
                            <label>${section}.${key}</label>
                            <input type="text" value="${value}" data-section="${section}" data-key="${key}">
                        </div>`;
                }
            }
            html += '</div>';
        }
        
        container.innerHTML = html || '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>';
    } catch (error) {
        container.innerHTML = '<p class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message + '</p>';
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
async function saveTranslations() {
    alert('–§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞. –¢—Ä–µ–±—É–µ—Ç—Å—è API endpoint –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Firestore.');
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Firebase
async function checkFirebaseStatus() {
    const statusEl = document.getElementById('firebase-status');
    statusEl.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
    statusEl.className = '';
    
    try {
        const response = await fetch('/api/health');
        const data = await response.json();
        
        if (data.firestore_available) {
            statusEl.textContent = '‚úì Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω';
            statusEl.className = 'success';
        } else {
            statusEl.textContent = '‚úó Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
            statusEl.className = 'error';
        }
    } catch (error) {
        statusEl.textContent = '‚úó –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
        statusEl.className = 'error';
    }
}

// –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
async function clearCache() {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à?')) return;
    
    try {
        const response = await fetch('/api/clear-cache');
        const data = await response.json();
        alert('–ö—ç—à —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω!');
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
}

// –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
async function exportData() {
    alert('–§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞.');
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
window.addEventListener('DOMContentLoaded', () => {
    loadTranslations();
    checkFirebaseStatus();
});
</script>

{% endblock %}

